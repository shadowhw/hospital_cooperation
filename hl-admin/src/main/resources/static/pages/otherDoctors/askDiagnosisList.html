<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../../css/oksub.css">
    <link rel="stylesheet" href="../../myicon/iconfont.css" type="text/css">
    <meta charset="UTF-8"/>
    <title>ç”³è¯·è¯Šæ–­</title>
</head>
<style>
    .list-con {
        padding: 0 10px 15px 10px;
        margin-bottom: 20px;
    }

    .list-con .layui-table td,
    .layui-table-view,
    .layui-table[lay-skin=line],
    .layui-table[lay-skin=row] {
        border: none;
    }

    .list-con .layui-table tbody {
        color: #777777;
    }

    .list-con .layui-table tbody tr:hover,
    .layui-table[lay-even] tr:nth-child(even) {
        background-color: rgb(226, 226, 226);
        color: black;
        font-weight: bold;
    }

    .layui-table tr {
        border-bottom: 1px #e2e2e2 solid;
    }

    .list-margin {
        margin-left: -30px;
    }

    .layui-table-tool-self {
        display: none;
    }

    .typeButton {
        height: 27px;
        vertical-align: middle;
        font-size: 13px;
        text-align: center;
        line-height: 27px;
    }

    .layui-btn-primary-inside {
        background-color: #1E9FFF;
        border: none;
        color: #FFF;
    }

    .layui-btn-normal-inside {
        background-color: #FFF;
        color: #1E9FFF;
        border: 1px solid #1E9FFF;
    }
</style>

<body>
<!-- è®©IE8/9æ”¯æŒåª’ä½“æŸ¥è¯¢ï¼Œä»è€Œå…¼å®¹æ …æ ¼ -->
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">

    <legend>ç”³è¯·è¯Šæ–­
        <button type="button" style="margin-left: 7px" id="uploadData"
                class="typeButton layui-btn layui-btn-primary layui-btn-primary-inside layui-btn-radius">
            ä¸Šä¼ ç”³è¯·
        </button>
        <input type="search" placeholder="è¯·æœç´¢" style="margin-left: 900px"><a href="">ğŸ”</a>
    </legend>
</fieldset>
<div class="search">
    <div class="layui-row">
        <div class="layui-col-md3">
            <div class="layui-form-item">
                <label class="layui-form-label">ç—…ä¾‹ç¼–ç </label>
                <div class="layui-input-block">
                    <input type="text" name="title" id="disgnose_code" autocomplete="off" placeholder="è¯·è¾“å…¥ç—…ä¾‹ç¼–ç " class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="layui-form-item">
                <label class="layui-form-label">æ‚£è€…å§“å</label>
                <div class="layui-input-block">
                    <input type="text" name="title" id="patient_name" autocomplete="off" placeholder="è¯·è¾“å…¥æ‚£è€…å§“å" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="layui-form-item">
                <label class="layui-form-label">æ‚£è€…èº«é«˜</label>
                <div class="layui-input-block">
                    <input type="text" name="title" id="patient_tall" autocomplete="off" placeholder="è¯·è¾“å…¥æ‚£è€…èº«é«˜" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="layui-form-item">
                <label class="layui-form-label">æ‚£è€…ä½“é‡</label>
                <div class="layui-input-block">
                    <input type="text" name="title" id="patient_weight" autocomplete="off" placeholder="è¯·è¾“å…¥æ‚£è€…ä½“é‡" class="layui-input">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="search">
    <div class="layui-row">
        <div class="layui-col-md3">
            <div class="layui-form-item">
                <label class="layui-form-label">è¯Šæ–­ç»“æœ</label>
                <div class="layui-input-block">
                    <input type="text" name="title" id="diagnose_result" autocomplete="off" placeholder="è¯·è¾“å…¥è¯Šæ–­ç»“æœ" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="layui-form-item">
                <label class="layui-form-label">ç”³è¯·æ—¶é—´</label>
                <div class="layui-input-block">
                    <input type="text" name="title" id="create_time" autocomplete="off" placeholder="è¯·è¾“å…¥ç”³è¯·æ—¶é—´" class="layui-input">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="layui-row">
    <form class="layui-form ok-form">
        <div class="layui-form-item" style="width: 25%">
            <label class="layui-form-label">å®¡æ ¸çŠ¶æ€</label>
            <div class="layui-input-block">
                <select name="stat" id="stat">
                    <option value="" selected="">å…¨éƒ¨</option>
                    <option value="1">å¾…åˆ†é…</option>
                    <option value="2">å·²é€€å›</option>
                    <option value="3">å·²è¢«åˆ†é…</option>
                    <option value="4">è¢«é©³å›</option>
                    <option value="5">å·²å®Œæˆ</option>
                </select>
            </div>
        </div>
        <div id="selectForm" style="float: right; margin-right:50px;"
             class="layui-btn layui-btn-normal layui-btn-radius">
            <i class="layui-icon layui-icon-search"></i>
        </div>
    </form>
</div>
<!--<div class="layui-row">-->
<!--    <form class="layui-form ok-form">-->
<!--        <div class="layui-form-item" style="width: 25%">-->
<!--            <label class="layui-form-label">å®¡æ ¸çŠ¶æ€</label>-->
<!--            <div class="layui-input-block">-->
<!--                <select name="stat" id="stat">-->
<!--                    <option value="" selected="">å…¨éƒ¨</option>-->
<!--                    <option value="1">å¾…åˆ†é…</option>-->
<!--                    <option value="2">å·²é€€å›</option>-->
<!--                    <option value="3">å·²è¢«åˆ†é…</option>-->
<!--                    <option value="4">è¢«é©³å›</option>-->
<!--                    <option value="5">å·²å®Œæˆ</option>-->
<!--                </select>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div id="selectForm" style="float: right; margin-right:50px;"-->
<!--             class="layui-btn layui-btn-normal layui-btn-radius">-->
<!--            <i class="layui-icon layui-icon-search"></i>-->
<!--        </div>-->
<!--    </form>-->
<!--</div>-->
<!--æ•°æ®è¡¨æ ¼-->
<div class="list-con">
    <table class="layui-hide" id="tableId" lay-filter="tableId"></table>
</div>
</body>
<script src="../../lib/layui/layui.js"></script>
<script src="/js/hyx.js"></script>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/application.js"></script>
<script>


    var selectType = "0"; //æŒ‰é’®çŠ¶æ€
    layui.use(["table", 'form', 'okLayer', 'layer'], function () {
        let $ = layui.jquery;
        let table = layui.table;
        let form = layui.form;
        let okLayer = layui.okLayer;
        let layer = layui.layer;
        var thisValue = -1;//æŸ¥è¯¢ç±»åˆ«
        //åˆ†æ´¾ä¿¡æ¯ç»‘å®š
        var articleTable = table.render({
            elem: "#tableId",
            url: "/getDisgnoseWithDoctorInfo",
            where: {
                // 'procTatus': thisValue//å½“å‰çš„çŠ¶æ€
            },
            parseData: function (res) { //res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®
                let datas = res.data;

                let rs = [];
                for(let i=0;i<datas.length;i++)
                {
                    let dia = {};
                    //æ ¼å¼åŒ–æ—¶é—´
                    let date = new Date(datas[i].disgnose_info.create_time).Format("yyyy-MM-dd HH:mm:ss");
                    //å‡ºç”Ÿæ—¥æœŸ
                    let birth = new Date(datas[i].disgnose_info.patient_birth).Format("yyyy-MM-dd");

                    dia.id = datas[i].disgnose_info.id;
                    dia.doctor_name = datas[i].doctor_info.doctor_name;
                    dia.patient_name = datas[i].disgnose_info.patient_name;
                    dia.patient_birth = birth;
                    dia.patient_tall = datas[i].disgnose_info.patient_tall;
                    dia.patient_weight = datas[i].disgnose_info.patient_weight;
                    dia.diagnose_result = datas[i].disgnose_info.diagnose_result;
                    dia.hos_nme = datas[i].hos_info.hos_name;
                    dia.create_time = date;
                    dia.comment_text = datas[i].disgnose_info.comment_text;
                    dia.stat = datas[i].disgnose_info.stat;

                    rs.push(dia);
                }

                return {
                    "code": 0, //è§£ææ¥å£çŠ¶æ€
                    "msg": res.msg, //è§£ææç¤ºæ–‡æœ¬
                    "count": res.count, //è§£ææ•°æ®é•¿åº¦
                    "data": rs //è§£ææ•°æ®åˆ—è¡¨
                };
            },
            cols: [
                [
                    //åºåˆ—å·
                    {field:'nums',type:"numbers",title:"åºå·"}
                    ,  {field:'nums',type:"numbers",title:"ç—…ä¾‹ç¼–ç ",width:150}
                    , {field: 'hos_nme', title: 'å•ä½åç§°', width: 250}//å•ä½åç§°é€šè¿‡åŒ»ç”Ÿä¿¡æ¯æŸ¥è¯¢
                    , {field: 'doctor_name', title: 'ç”³è¯·äºº', width: 100}
                    , {field: 'id', title: 'è¯Šæ–­ç¼–å·', width: 150, fixed: 'left', unresize: true, sort: true, hide:true}
                    , {field: 'patient_name', title: 'æ‚£è€…å§“å', width: 100}
                    , {field: 'patient_birth', title: 'æ‚£è€…å‡ºç”Ÿæ—¥æœŸ', width: 150}
                    , {field: 'patient_tall', title: 'æ‚£è€…èº«é«˜', width: 100}
                    , {field: 'patient_weight', title: 'æ‚£è€…ä½“é‡', width: 100}
                    , {field: 'diagnose_result', title: 'è¯Šæ–­', width: 250}
                    , {field: 'create_time', title: 'ç”³è¯·æ—¶é—´', width: 200}
                    ,{
                    field: "stat", title: "çŠ¶æ€", width: 100, templet: function (d) {
                        if (d.stat == 1) {
                            return "<div style='color:#d92d29;font-weight: bold;font-size:15px'>" + "æœªå¤„ç†" + "</div>"
                        }else if (d.stat == 2) {
                            return "<div style='color:#fae600;font-weight: bold;font-size:15px'>" + "å·²é€€å›" + "</div>"
                        }else if (d.stat == 3) {
                            return "<div style='color:#fae600;font-weight: bold;font-size:15px'>" + "å·²è¢«åˆ†é…" + "</div>"
                        }else if (d.stat == 4) {
                            return "<div style='color:#fae600;font-weight: bold;font-size:15px'>" + "è¢«é©³å›" + "</div>"
                        }else if (d.stat == 5) {
                            return "<div style='color:#fae600;font-weight: bold;font-size:15px'>" + "å·²å®Œæˆ" + "</div>"
                        }else{
                            return "<div style='color:#fae600;font-weight: bold;font-size:15px'>" + "å·²è¢«åˆ†é…" + "</div>"
                        }
                    }
                }
                    , {field: 'comment_text', title: 'å¤‡æ³¨',width:100}
                ]
            ],
            page: {
                layout: ['prev', 'page', 'next', 'skip', 'count'],
                groups: 3,
                limit: 10,
                theme: '#1E9FFF',
            },
        });

        //ç‚¹å‡»ä¸Šä¼ ç”³è¯·
        $("#uploadData").on("click",function(){
            layui.use(['element','layer','okLayer'], function () {
                let okLayer = layui.okLayer;
                // okLayer.open("æ–‡ä»¶ä¸Šä¼ ", "assist_upload.html", "80%", "80%", function (layero) {
                //     let iframeWin = window[layero.find("iframe")[0]["name"]];
                // }, function () {
                //
                // })
                var url = "/goUpload";
                show(url);
            })
        })

        //æ ¹æ®æ‰€é€‰æ‹©çš„çŠ¶æ€æŒ‰é’®ï¼Œè·³è½¬æ¡ˆä»¶çŠ¶æ€è¯¦ç»†é¡µé¢
        //æ ¹æ®æ‰€é€‰æ‹©çš„çŠ¶æ€æŒ‰é’®ï¼Œè·³è½¬æ¡ˆä»¶çŠ¶æ€è¯¦ç»†é¡µé¢
        table.on('row(tableId)', function (obj) {
            var data = obj.data;

            layer.open({
                type: 2,
                title: 'åˆ†é…ä»»åŠ¡',
                shadeClose: false,
                //shade: [0.3],
                btn: [ 'å…³é—­'],//å…³é—­æŒ‰é’®
                maxmin: false, //å¼€å¯æœ€å¤§åŒ–æœ€å°åŒ–æŒ‰é’®
                area: ['100%', '100%'],
                scrollbar: true, //å±è”½æ»šåŠ¨æ¡
                content: '/pages/assistDoctors/diagnosis_request.html?disgnose_id='+data.id
            });
            var state = data.procTatus;

            //var url = "/pages/admin/waitingForDistribution.html"
            //show(url);
            obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
        });

        //è·³è½¬è¯¦ç»†é¡µé¢è®¾ç½®
        function show(url) {
            window.open(url, 'newwindow', 'width=' + (window.screen.availWidth - 10) + ',height=' + (window.screen.availHeight - 30) + ', top=0, left=0, toolbar=no, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no')
        }

        //å›åˆ°å…¨éƒ¨é¡µé¢
        $("#changeType button").on('click', function () {
            $("#changeType button").removeClass("layui-btn-normal-inside");
            $(this).addClass("layui-btn-normal-inside")
            selectType = $(this).attr("selectType");
            thisValue = $(this).val();
            articleTable.reload({
                where: {
                    'procTatus': thisValue
                },
                page: {
                    curr: 1
                }
            })
        })
        //æœç´¢
        $("#selectForm").click(function () {
            let disgnose_code = $("#disgnose_code").val();
            let patient_name = $("#patient_name").val();
            let patient_tall = $("#patient_tall").val();
            let patient_weight = $("#patient_weight").val();
            let diagnose_result = $("#diagnose_result").val();
            let create_time = $("#create_time").val();
            let stat = $("#stat").val();


            //é‡è½½é¡µé¢
            articleTable.reload({
                url:"/get_diagnosis_list_by_params_assits",
                where: {
                    'disgnose_code': disgnose_code,
                    'patient_name':patient_name,
                    'patient_tall':patient_tall,
                    'patient_weight':patient_weight,
                    'diagnose_result':diagnose_result,
                    'create_time':create_time,
                    'stat':stat
                },
                page: {
                    curr: 1
                }
            })
        });


        //åˆ·æ–°é¡µé¢
        $("#selectEmpty").on('click', backAll);

        function backAll() {
            articleTable.reload({
                where: {
                    //ä¼ åˆ°æœåŠ¡å™¨æ•°æ®
                    'procTatus': thisValue,
                    'caseId': '',
                    'procLevel': '',
                    'caseDescription': '',
                    'startTime': '',
                    'endTime': ''
                },
                page: {
                    curr: 1//å›åˆ°ç¬¬ä¸€é¡µ
                }
            })
            return false;
        }
    })


</script>
</html>